<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <title>smitha-socket</title>

    <style>
        body, html {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
<div id="status"> smitha-socket is working </div>

<button id="button1"> click send</button>
<input id="sliderL" type="range" name="rangeInputL" value="0" min="-255" max="255" step="1">
<input id="sliderR" type="range" name="rangeInputR" value="0" min="-255" max="255" step="1">


<script src="/socket.io/socket.io.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function(e){

        var socket = io('192.168.1.110:3000');
        var button1 = document.getElementById('button1');
        var sliderR = document.getElementById('sliderR');
        var sliderL = document.getElementById('sliderL');

        socket.on('connect', function(socket){
            console.log('socket connection established!');
        });

        button1.addEventListener('click', function(e){

            sliderR.value = 0;
            sliderL.value = 0;
            console.log('ALL STOP!');
            socket.emit('message', '0,0,0,0;');
        });

        var motor1Dir = 0;
        var motor2Dir = 0;
        var sendValue1;
        var sendValue2;

        slider1.addEventListener('input', function(e){
            console.log(this.value);

            sendValue1 = sliderR.value;
            sendValue2 = sliderL.value;

            if (sendValue1 < 0){
                sendValue1 = Math.abs(sendValue1);
                motor1Dir = '0';
            } else {
                motor1Dir = '1';
            }

            if (sendValue2 < 0){
                sendValue2 = Math.abs(sendValue2);
                motor2Dir = '0';
            } else {
                motor2Dir = '1';
            }
            socket.emit('message', motor1Dir + ',' + sendValue1 + ',' + motor2Dir + ',' + sendValue2 + ';');
            //updateMotor(socket, motor1Dir, sendValue1, motor2Dir, sendValue2);
        });

        slider2.addEventListener('input', function(e){
            updateMotor(socket, motor1Dir, sendValue1, motor2Dir, sendValue2);
        });

        /**
         * update motor position for both motors.
         * @param socket Socket to pass in.
         * @param dir1 motor1 direction.
         * @param val1 motor1 value.
         * @param dir2 motor2 direction.
         * @param val2 motor2 value.
         */
        function updateMotor(socket, dir1, val1, dir2, val2){

            sendValue1 = sliderL.value;
            sendValue2 = sliderR.value;

            if (sendValue1 < 0){
                sendValue1 = Math.abs(sendValue1);
                motor1Dir = '0';
            } else {
                motor1Dir = '1';
            }

            if (sendValue2 < 0){
                sendValue2 = Math.abs(sendValue2);
                motor2Dir = '0';
            } else {
                motor2Dir = '1';
            }
            socket.emit('message', dir1 + ',' + val1 + ',' + dir2 + ',' + val2 + ';');
        }

    });


</script>
</body>
</html>